<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>chapter3</title>
      <style>.markdown-preview, .markdown-preview[data-use-github-style] { font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 1.6; word-wrap: break-word; overflow: scroll; box-sizing: border-box; padding: 20px; background-color: rgb(255, 255, 255); }
.markdown-preview > :first-child, .markdown-preview[data-use-github-style] > :first-child { margin-top: 0px !important; }
.markdown-preview > :last-child, .markdown-preview[data-use-github-style] > :last-child { margin-bottom: 0px !important; }
.markdown-preview a:not([href]), .markdown-preview[data-use-github-style] a:not([href]) { color: inherit; text-decoration: none; }
.markdown-preview .absent, .markdown-preview[data-use-github-style] .absent { color: rgb(204, 0, 0); }
.markdown-preview .anchor, .markdown-preview[data-use-github-style] .anchor { position: absolute; top: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; }
.markdown-preview .anchor:focus, .markdown-preview[data-use-github-style] .anchor:focus { outline: none; }
.markdown-preview h1, .markdown-preview[data-use-github-style] h1, .markdown-preview h2, .markdown-preview[data-use-github-style] h2, .markdown-preview h3, .markdown-preview[data-use-github-style] h3, .markdown-preview h4, .markdown-preview[data-use-github-style] h4, .markdown-preview h5, .markdown-preview[data-use-github-style] h5, .markdown-preview h6, .markdown-preview[data-use-github-style] h6 { position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; }
.markdown-preview h1 .octicon-link, .markdown-preview[data-use-github-style] h1 .octicon-link, .markdown-preview h2 .octicon-link, .markdown-preview[data-use-github-style] h2 .octicon-link, .markdown-preview h3 .octicon-link, .markdown-preview[data-use-github-style] h3 .octicon-link, .markdown-preview h4 .octicon-link, .markdown-preview[data-use-github-style] h4 .octicon-link, .markdown-preview h5 .octicon-link, .markdown-preview[data-use-github-style] h5 .octicon-link, .markdown-preview h6 .octicon-link, .markdown-preview[data-use-github-style] h6 .octicon-link { display: none; color: rgb(0, 0, 0); vertical-align: middle; }
.markdown-preview h1:hover .anchor, .markdown-preview[data-use-github-style] h1:hover .anchor, .markdown-preview h2:hover .anchor, .markdown-preview[data-use-github-style] h2:hover .anchor, .markdown-preview h3:hover .anchor, .markdown-preview[data-use-github-style] h3:hover .anchor, .markdown-preview h4:hover .anchor, .markdown-preview[data-use-github-style] h4:hover .anchor, .markdown-preview h5:hover .anchor, .markdown-preview[data-use-github-style] h5:hover .anchor, .markdown-preview h6:hover .anchor, .markdown-preview[data-use-github-style] h6:hover .anchor { padding-left: 8px; margin-left: -30px; text-decoration: none; }
.markdown-preview h1:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h1:hover .anchor .octicon-link, .markdown-preview h2:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h2:hover .anchor .octicon-link, .markdown-preview h3:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h3:hover .anchor .octicon-link, .markdown-preview h4:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h4:hover .anchor .octicon-link, .markdown-preview h5:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h5:hover .anchor .octicon-link, .markdown-preview h6:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h6:hover .anchor .octicon-link { display: inline-block; }
.markdown-preview h1 tt, .markdown-preview[data-use-github-style] h1 tt, .markdown-preview h2 tt, .markdown-preview[data-use-github-style] h2 tt, .markdown-preview h3 tt, .markdown-preview[data-use-github-style] h3 tt, .markdown-preview h4 tt, .markdown-preview[data-use-github-style] h4 tt, .markdown-preview h5 tt, .markdown-preview[data-use-github-style] h5 tt, .markdown-preview h6 tt, .markdown-preview[data-use-github-style] h6 tt, .markdown-preview h1 code, .markdown-preview[data-use-github-style] h1 code, .markdown-preview h2 code, .markdown-preview[data-use-github-style] h2 code, .markdown-preview h3 code, .markdown-preview[data-use-github-style] h3 code, .markdown-preview h4 code, .markdown-preview[data-use-github-style] h4 code, .markdown-preview h5 code, .markdown-preview[data-use-github-style] h5 code, .markdown-preview h6 code, .markdown-preview[data-use-github-style] h6 code { font-size: inherit; }
.markdown-preview h1, .markdown-preview[data-use-github-style] h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
.markdown-preview h1 .anchor, .markdown-preview[data-use-github-style] h1 .anchor { line-height: 1; }
.markdown-preview h2, .markdown-preview[data-use-github-style] h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
.markdown-preview h2 .anchor, .markdown-preview[data-use-github-style] h2 .anchor { line-height: 1; }
.markdown-preview h3, .markdown-preview[data-use-github-style] h3 { font-size: 1.5em; line-height: 1.43; }
.markdown-preview h3 .anchor, .markdown-preview[data-use-github-style] h3 .anchor { line-height: 1.2; }
.markdown-preview h4, .markdown-preview[data-use-github-style] h4 { font-size: 1.25em; }
.markdown-preview h4 .anchor, .markdown-preview[data-use-github-style] h4 .anchor { line-height: 1.2; }
.markdown-preview h5, .markdown-preview[data-use-github-style] h5 { font-size: 1em; }
.markdown-preview h5 .anchor, .markdown-preview[data-use-github-style] h5 .anchor { line-height: 1.1; }
.markdown-preview h6, .markdown-preview[data-use-github-style] h6 { font-size: 1em; color: rgb(119, 119, 119); }
.markdown-preview h6 .anchor, .markdown-preview[data-use-github-style] h6 .anchor { line-height: 1.1; }
.markdown-preview p, .markdown-preview[data-use-github-style] p, .markdown-preview blockquote, .markdown-preview[data-use-github-style] blockquote, .markdown-preview ul, .markdown-preview[data-use-github-style] ul, .markdown-preview ol, .markdown-preview[data-use-github-style] ol, .markdown-preview dl, .markdown-preview[data-use-github-style] dl, .markdown-preview table, .markdown-preview[data-use-github-style] table, .markdown-preview pre, .markdown-preview[data-use-github-style] pre { margin-top: 0px; margin-bottom: 16px; }
.markdown-preview hr, .markdown-preview[data-use-github-style] hr { height: 4px; padding: 0px; margin: 16px 0px; border: 0px none; background-color: rgb(231, 231, 231); }
.markdown-preview ul, .markdown-preview[data-use-github-style] ul, .markdown-preview ol, .markdown-preview[data-use-github-style] ol { padding-left: 2em; }
.markdown-preview ul.no-list, .markdown-preview[data-use-github-style] ul.no-list, .markdown-preview ol.no-list, .markdown-preview[data-use-github-style] ol.no-list { padding: 0px; list-style-type: none; }
.markdown-preview ul ul, .markdown-preview[data-use-github-style] ul ul, .markdown-preview ul ol, .markdown-preview[data-use-github-style] ul ol, .markdown-preview ol ol, .markdown-preview[data-use-github-style] ol ol, .markdown-preview ol ul, .markdown-preview[data-use-github-style] ol ul { margin-top: 0px; margin-bottom: 0px; }
.markdown-preview li > p, .markdown-preview[data-use-github-style] li > p { margin-top: 16px; }
.markdown-preview dl, .markdown-preview[data-use-github-style] dl { padding: 0px; }
.markdown-preview dl dt, .markdown-preview[data-use-github-style] dl dt { padding: 0px; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; }
.markdown-preview dl dd, .markdown-preview[data-use-github-style] dl dd { padding: 0px 16px; margin-bottom: 16px; }
.markdown-preview blockquote, .markdown-preview[data-use-github-style] blockquote { padding: 0px 15px; color: rgb(119, 119, 119); border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); }
.markdown-preview blockquote > :first-child, .markdown-preview[data-use-github-style] blockquote > :first-child { margin-top: 0px; }
.markdown-preview blockquote > :last-child, .markdown-preview[data-use-github-style] blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview table, .markdown-preview[data-use-github-style] table { display: block; width: 100%; overflow: auto; word-break: normal; }
.markdown-preview table th, .markdown-preview[data-use-github-style] table th { font-weight: bold; }
.markdown-preview table th, .markdown-preview[data-use-github-style] table th, .markdown-preview table td, .markdown-preview[data-use-github-style] table td { padding: 6px 13px; border: 1px solid rgb(221, 221, 221); }
.markdown-preview table tr, .markdown-preview[data-use-github-style] table tr { border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(255, 255, 255); }
.markdown-preview table tr:nth-child(2n), .markdown-preview[data-use-github-style] table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
.markdown-preview img, .markdown-preview[data-use-github-style] img { max-width: 100%; box-sizing: border-box; }
.markdown-preview .emoji, .markdown-preview[data-use-github-style] .emoji { max-width: none; }
.markdown-preview span.frame, .markdown-preview[data-use-github-style] span.frame { display: block; overflow: hidden; }
.markdown-preview span.frame > span, .markdown-preview[data-use-github-style] span.frame > span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0px 0px; overflow: hidden; border: 1px solid rgb(221, 221, 221); }
.markdown-preview span.frame span img, .markdown-preview[data-use-github-style] span.frame span img { display: block; float: left; }
.markdown-preview span.frame span span, .markdown-preview[data-use-github-style] span.frame span span { display: block; padding: 5px 0px 0px; clear: both; color: rgb(51, 51, 51); }
.markdown-preview span.align-center, .markdown-preview[data-use-github-style] span.align-center { display: block; overflow: hidden; clear: both; }
.markdown-preview span.align-center > span, .markdown-preview[data-use-github-style] span.align-center > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: center; }
.markdown-preview span.align-center span img, .markdown-preview[data-use-github-style] span.align-center span img { margin: 0px auto; text-align: center; }
.markdown-preview span.align-right, .markdown-preview[data-use-github-style] span.align-right { display: block; overflow: hidden; clear: both; }
.markdown-preview span.align-right > span, .markdown-preview[data-use-github-style] span.align-right > span { display: block; margin: 13px 0px 0px; overflow: hidden; text-align: right; }
.markdown-preview span.align-right span img, .markdown-preview[data-use-github-style] span.align-right span img { margin: 0px; text-align: right; }
.markdown-preview span.float-left, .markdown-preview[data-use-github-style] span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; }
.markdown-preview span.float-left span, .markdown-preview[data-use-github-style] span.float-left span { margin: 13px 0px 0px; }
.markdown-preview span.float-right, .markdown-preview[data-use-github-style] span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; }
.markdown-preview span.float-right > span, .markdown-preview[data-use-github-style] span.float-right > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: right; }
.markdown-preview code, .markdown-preview[data-use-github-style] code, .markdown-preview tt, .markdown-preview[data-use-github-style] tt { padding: 0.2em 0px; margin: 0px; font-size: 85%; border-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157); }
.markdown-preview code::before, .markdown-preview[data-use-github-style] code::before, .markdown-preview tt::before, .markdown-preview[data-use-github-style] tt::before, .markdown-preview code::after, .markdown-preview[data-use-github-style] code::after, .markdown-preview tt::after, .markdown-preview[data-use-github-style] tt::after { letter-spacing: -0.2em; content: 'Â '; }
.markdown-preview code br, .markdown-preview[data-use-github-style] code br, .markdown-preview tt br, .markdown-preview[data-use-github-style] tt br { display: none; }
.markdown-preview del code, .markdown-preview[data-use-github-style] del code { text-decoration: inherit; }
.markdown-preview pre > code, .markdown-preview[data-use-github-style] pre > code { padding: 0px; margin: 0px; font-size: 100%; word-break: normal; white-space: pre; border: 0px; background: transparent; }
.markdown-preview .highlight, .markdown-preview[data-use-github-style] .highlight { margin-bottom: 16px; }
.markdown-preview .highlight pre, .markdown-preview[data-use-github-style] .highlight pre, .markdown-preview pre, .markdown-preview[data-use-github-style] pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; border-radius: 3px; background-color: rgb(247, 247, 247); }
.markdown-preview .highlight pre, .markdown-preview[data-use-github-style] .highlight pre { margin-bottom: 0px; word-break: normal; }
.markdown-preview pre, .markdown-preview[data-use-github-style] pre { word-wrap: normal; }
.markdown-preview pre code, .markdown-preview[data-use-github-style] pre code, .markdown-preview pre tt, .markdown-preview[data-use-github-style] pre tt { display: inline; max-width: initial; padding: 0px; margin: 0px; overflow: initial; line-height: inherit; word-wrap: normal; border: 0px; background-color: transparent; }
.markdown-preview pre code::before, .markdown-preview[data-use-github-style] pre code::before, .markdown-preview pre tt::before, .markdown-preview[data-use-github-style] pre tt::before, .markdown-preview pre code::after, .markdown-preview[data-use-github-style] pre code::after, .markdown-preview pre tt::after, .markdown-preview[data-use-github-style] pre tt::after { content: normal; }
.markdown-preview kbd, .markdown-preview[data-use-github-style] kbd { display: inline-block; padding: 3px 5px; font-size: 11px; line-height: 10px; color: rgb(85, 85, 85); vertical-align: middle; border-style: solid; border-width: 1px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(187, 187, 187); border-radius: 3px; box-shadow: rgb(187, 187, 187) 0px -1px 0px inset; background-color: rgb(252, 252, 252); }
.markdown-preview, .markdown-preview[data-use-github-style], .markdown-preview code, .markdown-preview[data-use-github-style] code { color: rgb(51, 51, 51); }
.markdown-preview h1, .markdown-preview[data-use-github-style] h1, .markdown-preview h2, .markdown-preview[data-use-github-style] h2, .markdown-preview h3, .markdown-preview[data-use-github-style] h3, .markdown-preview h4, .markdown-preview[data-use-github-style] h4, .markdown-preview h5, .markdown-preview[data-use-github-style] h5, .markdown-preview h6, .markdown-preview[data-use-github-style] h6 { -webkit-font-smoothing: antialiased; cursor: text; }
.markdown-preview > h1:first-child, .markdown-preview[data-use-github-style] > h1:first-child, .markdown-preview > h1:first-child + h2, .markdown-preview[data-use-github-style] > h1:first-child + h2, .markdown-preview > h2:first-child, .markdown-preview[data-use-github-style] > h2:first-child, .markdown-preview > h3:first-child, .markdown-preview[data-use-github-style] > h3:first-child, .markdown-preview > h4:first-child, .markdown-preview[data-use-github-style] > h4:first-child, .markdown-preview > h5:first-child, .markdown-preview[data-use-github-style] > h5:first-child, .markdown-preview > h6:first-child, .markdown-preview[data-use-github-style] > h6:first-child { margin-top: 0px; padding-top: 0px; }
.markdown-preview a, .markdown-preview[data-use-github-style] a, .markdown-preview a code, .markdown-preview[data-use-github-style] a code { color: rgb(65, 131, 196); }
.markdown-preview a:first-child h1, .markdown-preview[data-use-github-style] a:first-child h1, .markdown-preview a:first-child h2, .markdown-preview[data-use-github-style] a:first-child h2, .markdown-preview a:first-child h3, .markdown-preview[data-use-github-style] a:first-child h3, .markdown-preview a:first-child h4, .markdown-preview[data-use-github-style] a:first-child h4, .markdown-preview a:first-child h5, .markdown-preview[data-use-github-style] a:first-child h5, .markdown-preview a:first-child h6, .markdown-preview[data-use-github-style] a:first-child h6 { margin-top: 0px; padding-top: 0px; }
.markdown-preview h1 + p, .markdown-preview[data-use-github-style] h1 + p, .markdown-preview h2 + p, .markdown-preview[data-use-github-style] h2 + p, .markdown-preview h3 + p, .markdown-preview[data-use-github-style] h3 + p, .markdown-preview h4 + p, .markdown-preview[data-use-github-style] h4 + p, .markdown-preview h5 + p, .markdown-preview[data-use-github-style] h5 + p, .markdown-preview h6 + p, .markdown-preview[data-use-github-style] h6 + p { margin-top: 0px; }
.markdown-preview li p.first, .markdown-preview[data-use-github-style] li p.first { display: inline-block; }
.markdown-preview ul li > :first-child, .markdown-preview[data-use-github-style] ul li > :first-child, .markdown-preview ol li > :first-child, .markdown-preview[data-use-github-style] ol li > :first-child, .markdown-preview ul li ul:first-of-type, .markdown-preview[data-use-github-style] ul li ul:first-of-type, .markdown-preview ol li ul:first-of-type, .markdown-preview[data-use-github-style] ol li ul:first-of-type { margin-top: 0px; }
.markdown-preview ol > li, .markdown-preview[data-use-github-style] ol > li { list-style-type: decimal; }
.markdown-preview ul > li, .markdown-preview[data-use-github-style] ul > li { list-style-type: disc; }
.markdown-preview dl dt:first-child, .markdown-preview[data-use-github-style] dl dt:first-child { padding: 0px; }
.markdown-preview dl dt > :first-child, .markdown-preview[data-use-github-style] dl dt > :first-child { margin-top: 0px; }
.markdown-preview dl dt > :last-child, .markdown-preview[data-use-github-style] dl dt > :last-child { margin-bottom: 0px; }
.markdown-preview dl dd > :first-child, .markdown-preview[data-use-github-style] dl dd > :first-child { margin-top: 0px; }
.markdown-preview dl dd > :last-child, .markdown-preview[data-use-github-style] dl dd > :last-child { margin-bottom: 0px; }
.markdown-preview blockquote p, .markdown-preview[data-use-github-style] blockquote p { font-size: 16px; line-height: 1.5; }
.markdown-preview pre.editor-colors, .markdown-preview[data-use-github-style] pre.editor-colors { padding: 16px; overflow: auto; font-size: 84%; line-height: 1.45; border-radius: 3px; background-color: rgb(40, 44, 52); }
.markdown-preview pre.editor-colors, .markdown-preview[data-use-github-style] pre.editor-colors { margin-bottom: 16px; word-break: normal; }
.markdown-preview code, .markdown-preview[data-use-github-style] code, .markdown-preview tt, .markdown-preview[data-use-github-style] tt, .markdown-preview pre.editor-colors, .markdown-preview[data-use-github-style] pre.editor-colors { font-family: Consolas, 'Liberation Mono', Courier, monospace; }
.markdown-preview .emoji, .markdown-preview[data-use-github-style] .emoji { height: 20px; width: 20px; }
.markdown-preview { font-size: 1.25em; color: rgb(44, 49, 58); background-color: rgb(241, 242, 244); }
.markdown-preview h1, .markdown-preview h2 { color: inherit; border-color: rgb(186, 191, 202); }
.markdown-preview a { color: rgb(20, 146, 255); }
.markdown-preview hr { background-color: rgb(241, 242, 244); }
.markdown-preview blockquote { color: rgb(44, 49, 58); border-left-color: rgb(117, 127, 149); }
.markdown-preview table th, .markdown-preview table td { border-color: rgb(186, 191, 202); }
.markdown-preview table th { background-color: rgb(249, 250, 251); }
.markdown-preview table tr { background-color: rgb(241, 242, 244); }
.markdown-preview table tr:nth-child(2n) { background-color: rgb(232, 234, 237); }
.markdown-preview code { color: rgb(67, 73, 86); border-color: rgb(186, 191, 202); background-color: rgb(229, 231, 235); background-clip: padding-box; }
.markdown-preview pre.editor-colors::shadow .line.cursor-line { background-color: transparent; }
.bracket-matcher .region {
  border-bottom: 1px dotted lime;
  position: absolute;
}

.spell-check-misspelling .region {
  border-bottom: 1px dashed rgba(250, 128, 114, 0.5);
}

pre.editor-colors,
.host {
  background-color: #282c34;
  color: #abb2bf;
}
pre.editor-colors .line.cursor-line,
.host .line.cursor-line {
  background-color: rgba(153, 187, 255, 0.04);
}
pre.editor-colors .invisible,
.host .invisible {
  color: #abb2bf;
}
pre.editor-colors .cursor,
.host .cursor {
  border-left: 2px solid #528bff;
}
pre.editor-colors .selection .region,
.host .selection .region {
  background-color: #3e4451;
}
pre.editor-colors .bracket-matcher .region,
.host .bracket-matcher .region {
  border-bottom: 1px solid #528bff;
  box-sizing: border-box;
  background-color: #353b45;
}
pre.editor-colors .invisible-character,
.host .invisible-character {
  color: rgba(171, 178, 191, 0.15);
}
pre.editor-colors .indent-guide,
.host .indent-guide {
  color: rgba(171, 178, 191, 0.15);
}
pre.editor-colors .wrap-guide,
.host .wrap-guide {
  background-color: rgba(171, 178, 191, 0.15);
}
pre.editor-colors .gutter .line-number,
.host .gutter .line-number {
  color: #636d83;
  -webkit-font-smoothing: antialiased;
}
pre.editor-colors .gutter .line-number.git-line-removed:before,
.host .gutter .line-number.git-line-removed:before {
  bottom: -3px;
}
pre.editor-colors .gutter .line-number.git-line-removed:after,
.host .gutter .line-number.git-line-removed:after {
  content: "";
  position: absolute;
  left: 0px;
  bottom: 0px;
  width: 25px;
  border-bottom: 1px dotted rgba(224, 82, 82, 0.5);
  pointer-events: none;
}
pre.editor-colors .gutter .line-number.cursor-line,
.host .gutter .line-number.cursor-line {
  color: #abb2bf;
  background-color: #2c313a;
}
pre.editor-colors .gutter .line-number.cursor-line-no-selection,
.host .gutter .line-number.cursor-line-no-selection {
  background-color: transparent;
}
pre.editor-colors .gutter .line-number .icon-right,
.host .gutter .line-number .icon-right {
  color: #abb2bf;
}
pre.editor-colors .gutter .line-number .icon-right,
.host .gutter .line-number .icon-right {
  color: #abb2bf;
}
pre.editor-colors .gutter .line-number.folded,
.host .gutter .line-number.folded,
pre.editor-colors .gutter .line-number:after,
.host .gutter .line-number:after,
pre.editor-colors .fold-marker:after,
.host .fold-marker:after {
  color: #abb2bf;
}
.comment {
  color: #5c6370;
  font-style: italic;
}
.entity.name.type {
  color: #e5c07b;
}
.entity.other.inherited-class {
  color: #98c379;
}
.keyword {
  color: #c678dd;
}
.keyword.control {
  color: #c678dd;
}
.keyword.operator {
  color: #abb2bf;
}
.keyword.other.special-method {
  color: #61afef;
}
.keyword.other.unit {
  color: #d19a66;
}
.storage {
  color: #c678dd;
}
.storage.type.annotation,
.storage.type.primitive {
  color: #c678dd;
}
.storage.modifier.package,
.storage.modifier.import {
  color: #abb2bf;
}
.constant {
  color: #d19a66;
}
.constant.variable {
  color: #d19a66;
}
.constant.character.escape {
  color: #56b6c2;
}
.constant.numeric {
  color: #d19a66;
}
.constant.other.color {
  color: #56b6c2;
}
.constant.other.symbol {
  color: #56b6c2;
}
.variable {
  color: #e06c75;
}
.variable.interpolation {
  color: #be5046;
}
.variable.parameter {
  color: #abb2bf;
}
.invalid.illegal {
  background-color: #e06c75;
  color: #282c34;
}
.string {
  color: #98c379;
}
.string.regexp {
  color: #56b6c2;
}
.string.regexp .source.ruby.embedded {
  color: #e5c07b;
}
.string.other.link {
  color: #e06c75;
}
.punctuation.definition.comment {
  color: #5c6370;
}
.punctuation.definition.method-parameters,
.punctuation.definition.function-parameters,
.punctuation.definition.parameters,
.punctuation.definition.separator,
.punctuation.definition.seperator,
.punctuation.definition.array {
  color: #abb2bf;
}
.punctuation.definition.heading,
.punctuation.definition.identity {
  color: #61afef;
}
.punctuation.definition.bold {
  color: #e5c07b;
  font-weight: bold;
}
.punctuation.definition.italic {
  color: #c678dd;
  font-style: italic;
}
.punctuation.section.embedded {
  color: #be5046;
}
.punctuation.section.method,
.punctuation.section.class,
.punctuation.section.inner-class {
  color: #abb2bf;
}
.support.class {
  color: #e5c07b;
}
.support.function {
  color: #56b6c2;
}
.support.function.any-method {
  color: #61afef;
}
.entity.name.function {
  color: #61afef;
}
.entity.name.class,
.entity.name.type.class {
  color: #e5c07b;
}
.entity.name.section {
  color: #61afef;
}
.entity.name.tag {
  color: #e06c75;
}
.entity.other.attribute-name {
  color: #d19a66;
}
.entity.other.attribute-name.id {
  color: #61afef;
}
.meta.class {
  color: #e5c07b;
}
.meta.class.body {
  color: #abb2bf;
}
.meta.method-call,
.meta.method {
  color: #abb2bf;
}
.meta.definition.variable {
  color: #e06c75;
}
.meta.link {
  color: #d19a66;
}
.meta.require {
  color: #61afef;
}
.meta.selector {
  color: #c678dd;
}
.meta.separator {
  background-color: #373b41;
  color: #abb2bf;
}
.meta.tag {
  color: #abb2bf;
}
.none {
  color: #abb2bf;
}
.markup.bold {
  color: #d19a66;
  font-weight: bold;
}
.markup.changed {
  color: #c678dd;
}
.markup.deleted {
  color: #e06c75;
}
.markup.italic {
  color: #c678dd;
  font-style: italic;
}
.markup.heading .punctuation.definition.heading {
  color: #61afef;
}
.markup.inserted {
  color: #98c379;
}
.markup.list {
  color: #e06c75;
}
.markup.quote {
  color: #d19a66;
}
.markup.raw.inline {
  color: #98c379;
}
.source.cs .keyword.operator {
  color: #c678dd;
}
.source.css .property-name,
.source.css .property-value {
  color: #828997;
}
.source.css .property-name.support,
.source.css .property-value.support {
  color: #abb2bf;
}
.source.gfm .markup {
  -webkit-font-smoothing: auto;
}
.source.gfm .markup.heading {
  color: #e06c75;
}
.source.gfm .markup.link {
  color: #c678dd;
}
.source.gfm .link .entity {
  color: #61afef;
}
.source.ini .keyword.other.definition.ini {
  color: #e06c75;
}
.source.java .storage.modifier.import {
  color: #e5c07b;
}
.source.java .storage.type {
  color: #e5c07b;
}
.source.java-properties .meta.key-pair {
  color: #e06c75;
}
.source.java-properties .meta.key-pair > .punctuation {
  color: #abb2bf;
}
.source.json .meta.structure.dictionary.json > .string.quoted.json {
  color: #e06c75;
}
.source.json .meta.structure.dictionary.json > .string.quoted.json > .punctuation.string {
  color: #e06c75;
}
.source.json .meta.structure.dictionary.json > .value.json > .string.quoted.json,
.source.json .meta.structure.array.json > .value.json > .string.quoted.json,
.source.json .meta.structure.dictionary.json > .value.json > .string.quoted.json > .punctuation,
.source.json .meta.structure.array.json > .value.json > .string.quoted.json > .punctuation {
  color: #98c379;
}
.source.json .meta.structure.dictionary.json > .constant.language.json,
.source.json .meta.structure.array.json > .constant.language.json {
  color: #56b6c2;
}
.source.ruby .constant.other.symbol > .punctuation {
  color: inherit;
}
.source.python .keyword.operator.logical.python {
  color: #c678dd;
}
.source.python .variable.parameter {
  color: #d19a66;
}
</style>
  </head>
  <body class='markdown-preview'><h1 id="-center-3-crud-center-"><center>3. CRUD</center></h1>
<p><br></p>
<h2 id="3-1-database-schema">3.1 Database schema</h2>
<p>We will extend our database schema to add some of the concepts a typical e-commerce application may need. A global view of the database schema we are going to create:</p>
<p><img src="/home/skafandri/symfony-tutorial/book/schema1.png" alt="database schema"></p>
<p><br><br><br><br><br></p>
<p>We have already created <strong>category</strong>, <strong>product</strong> and <strong>category_has_product</strong> tables, now we proceed with the rest.</p>
<pre class="editor-colors lang-sql"><div class="line"><span class="source sql"><span class="comment block c"><span class="punctuation definition comment sql"><span>/*</span></span><span>&nbsp;Warehouse&nbsp;</span><span class="punctuation definition comment sql"><span>*/</span></span></span></span></div><div class="line"><span class="source sql"><span class="meta create sql"><span class="keyword other create sql"><span>CREATE</span></span><span>&nbsp;</span><span class="keyword other sql"><span>TABLE</span></span><span>&nbsp;</span><span class="entity name function sql"><span>IF</span></span></span><span>&nbsp;NOT&nbsp;EXISTS&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>warehouse`</span></span><span>&nbsp;(</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>SMALLINT</span></span><span>(</span><span class="constant numeric sql"><span>5</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>&nbsp;AUTO_INCREMENT,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>name`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>45</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>PRIMARY&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>)&nbsp;)</span></span></div><div class="line"><span class="source sql"><span>ENGINE&nbsp;</span><span class="keyword operator comparison sql"><span>=</span></span><span>&nbsp;InnoDB;</span></span></div><div class="line"><span class="source sql"><span>&nbsp;</span></span></div><div class="line"><span class="source sql"><span class="comment block c"><span class="punctuation definition comment sql"><span>/*</span></span><span>&nbsp;Product&nbsp;Stock&nbsp;</span><span class="punctuation definition comment sql"><span>*/</span></span></span></span></div><div class="line"><span class="source sql"><span class="meta create sql"><span class="keyword other create sql"><span>CREATE</span></span><span>&nbsp;</span><span class="keyword other sql"><span>TABLE</span></span><span>&nbsp;</span><span class="entity name function sql"><span>IF</span></span></span><span>&nbsp;NOT&nbsp;EXISTS&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product_stock`</span></span><span>&nbsp;(</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>&nbsp;AUTO_INCREMENT,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product_id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>warehouse_id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>SMALLINT</span></span><span>(</span><span class="constant numeric sql"><span>5</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>quantity`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="constant numeric sql"><span>0</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>PRIMARY&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_product_id`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product_id`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_warehouse_id`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>warehouse_id`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>CONSTRAINT</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>fk_product_stock_product_id`</span></span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>FOREIGN&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product_id`</span></span><span>)</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>REFERENCES</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>),</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>CONSTRAINT</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>fk_product_stock_warehouse_id`</span></span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>FOREIGN&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>warehouse_id`</span></span><span>)</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>REFERENCES</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>warehouse`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>))</span></span></div><div class="line"><span class="source sql"><span>ENGINE&nbsp;</span><span class="keyword operator comparison sql"><span>=</span></span><span>&nbsp;InnoDB;</span></span></div><div class="line"><span class="source sql"><span>&nbsp;</span></span></div><div class="line"><span class="source sql"><span class="comment block c"><span class="punctuation definition comment sql"><span>/*</span></span><span>&nbsp;Country&nbsp;</span><span class="punctuation definition comment sql"><span>*/</span></span></span></span></div><div class="line"><span class="source sql"><span class="meta create sql"><span class="keyword other create sql"><span>CREATE</span></span><span>&nbsp;</span><span class="keyword other sql"><span>TABLE</span></span><span>&nbsp;</span><span class="entity name function sql"><span>IF</span></span></span><span>&nbsp;NOT&nbsp;EXISTS&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>country`</span></span><span>&nbsp;(</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>SMALLINT</span></span><span>(</span><span class="constant numeric sql"><span>6</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>&nbsp;AUTO_INCREMENT,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>code`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>5</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>name`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>60</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>currency`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>3</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>PRIMARY&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>)&nbsp;)</span></span></div><div class="line"><span class="source sql"><span>ENGINE&nbsp;</span><span class="keyword operator comparison sql"><span>=</span></span><span>&nbsp;InnoDB;</span></span></div><div class="line"><span class="source sql"><span>&nbsp;</span></span></div><div class="line"><span class="source sql"><span class="comment block c"><span class="punctuation definition comment sql"><span>/*</span></span><span>&nbsp;Address&nbsp;</span><span class="punctuation definition comment sql"><span>*/</span></span></span></span></div><div class="line"><span class="source sql"><span class="meta create sql"><span class="keyword other create sql"><span>CREATE</span></span><span>&nbsp;</span><span class="keyword other sql"><span>TABLE</span></span><span>&nbsp;</span><span class="entity name function sql"><span>IF</span></span></span><span>&nbsp;NOT&nbsp;EXISTS&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>address`</span></span><span>&nbsp;(</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>&nbsp;AUTO_INCREMENT,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>country_id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>SMALLINT</span></span><span>(</span><span class="constant numeric sql"><span>6</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>name`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>45</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>city`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>45</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>street_name`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>45</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>street_number`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>45</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>building`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>45</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>entrance`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>45</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>number`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>45</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>deleted`</span></span><span>&nbsp;</span><span class="storage type sql"><span>TINYINT</span></span><span>(</span><span class="constant numeric sql"><span>1</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>PRIMARY&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_country_id`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>country_id`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>CONSTRAINT</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>fk_address_country_id`</span></span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>FOREIGN&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>country_id`</span></span><span>)</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>REFERENCES</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>country`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>))</span></span></div><div class="line"><span class="source sql"><span>ENGINE&nbsp;</span><span class="keyword operator comparison sql"><span>=</span></span><span>&nbsp;InnoDB;</span></span></div></pre>
<pre class="editor-colors lang-sql"><div class="line"><span class="source sql"><span class="comment block c"><span class="punctuation definition comment sql"><span>/*</span></span><span>&nbsp;Customer&nbsp;</span><span class="punctuation definition comment sql"><span>*/</span></span></span></span></div><div class="line"><span class="source sql"><span class="meta create sql"><span class="keyword other create sql"><span>CREATE</span></span><span>&nbsp;</span><span class="keyword other sql"><span>TABLE</span></span><span>&nbsp;</span><span class="entity name function sql"><span>IF</span></span></span><span>&nbsp;NOT&nbsp;EXISTS&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>customer`</span></span><span>&nbsp;(</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>&nbsp;AUTO_INCREMENT,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>name`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>45</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>email`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>45</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>mobile_phone`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>45</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>phone`</span></span><span>&nbsp;</span><span class="storage type sql"><span>VARCHAR</span></span><span>(</span><span class="constant numeric sql"><span>45</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>PRIMARY&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>)&nbsp;)</span></span></div><div class="line"><span class="source sql"><span>ENGINE&nbsp;</span><span class="keyword operator comparison sql"><span>=</span></span><span>&nbsp;InnoDB;</span></span></div><div class="line"><span class="source sql"><span>&nbsp;</span></span></div><div class="line"><span class="source sql"><span>&nbsp;</span></span></div><div class="line"><span class="source sql"><span class="comment block c"><span class="punctuation definition comment sql"><span>/*</span></span><span>&nbsp;Customer&nbsp;Has&nbsp;Address&nbsp;</span><span class="punctuation definition comment sql"><span>*/</span></span></span></span></div><div class="line"><span class="source sql"><span class="meta create sql"><span class="keyword other create sql"><span>CREATE</span></span><span>&nbsp;</span><span class="keyword other sql"><span>TABLE</span></span><span>&nbsp;</span><span class="entity name function sql"><span>IF</span></span></span><span>&nbsp;NOT&nbsp;EXISTS&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>customer_has_address`</span></span><span>&nbsp;(</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>address_id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>customer_id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>PRIMARY&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>address_id`</span></span><span>,&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>customer_id`</span></span><span>),</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_address_id`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>address_id`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_customer_id`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>customer_id`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>CONSTRAINT</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>fk_customer_has_address_address_id`</span></span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>FOREIGN&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>address_id`</span></span><span>)</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>REFERENCES</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>address`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>),</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>CONSTRAINT</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>fk_customer_has_address_customer_id`</span></span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>FOREIGN&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>customer_id`</span></span><span>)</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>REFERENCES</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>customer`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>))</span></span></div><div class="line"><span class="source sql"><span>ENGINE&nbsp;</span><span class="keyword operator comparison sql"><span>=</span></span><span>&nbsp;InnoDB;</span></span></div><div class="line"><span class="source sql"><span>&nbsp;</span></span></div><div class="line"><span class="source sql"><span>&nbsp;</span></span></div><div class="line"><span class="source sql"><span class="comment block c"><span class="punctuation definition comment sql"><span>/*</span></span><span>&nbsp;Order&nbsp;</span><span class="punctuation definition comment sql"><span>*/</span></span></span></span></div><div class="line"><span class="source sql"><span class="meta create sql"><span class="keyword other create sql"><span>CREATE</span></span><span>&nbsp;</span><span class="keyword other sql"><span>TABLE</span></span><span>&nbsp;</span><span class="entity name function sql"><span>IF</span></span></span><span>&nbsp;NOT&nbsp;EXISTS&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>order`</span></span><span>&nbsp;(</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>&nbsp;AUTO_INCREMENT,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>shipping_address_id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>billing_address_id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>status`</span></span><span>&nbsp;</span><span class="storage type sql"><span>TINYINT</span></span><span>(</span><span class="constant numeric sql"><span>4</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>create_date`</span></span><span>&nbsp;DATETIME&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>customer_id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>PRIMARY&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>,&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>customer_id`</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_shipping_address_id`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>shipping_address_id`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_billing_address_id`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>billing_address_id`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_status`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>status`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_customer_id`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>customer_id`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>CONSTRAINT</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>fk_order_shipping_address_id`</span></span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>FOREIGN&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>shipping_address_id`</span></span><span>)</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>REFERENCES</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>address`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>),</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>CONSTRAINT</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>fk_order_billing_address_id`</span></span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>FOREIGN&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>billing_address_id`</span></span><span>)</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>REFERENCES</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>address`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>),</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>CONSTRAINT</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>fk_order_customer_id`</span></span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>FOREIGN&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>customer_id`</span></span><span>)</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>REFERENCES</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>customer`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>))</span></span></div><div class="line"><span class="source sql"><span>ENGINE&nbsp;</span><span class="keyword operator comparison sql"><span>=</span></span><span>&nbsp;InnoDB;</span></span></div></pre>
<p><br><br><br></p>
<pre class="editor-colors lang-sql"><div class="line"><span class="source sql"><span class="comment block c"><span class="punctuation definition comment sql"><span>/*</span></span><span>&nbsp;Product&nbsp;Sale&nbsp;</span><span class="punctuation definition comment sql"><span>*/</span></span></span></span></div><div class="line"><span class="source sql"><span class="meta create sql"><span class="keyword other create sql"><span>CREATE</span></span><span>&nbsp;</span><span class="keyword other sql"><span>TABLE</span></span><span>&nbsp;</span><span class="entity name function sql"><span>IF</span></span></span><span>&nbsp;NOT&nbsp;EXISTS&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product_sale`</span></span><span>&nbsp;(</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>&nbsp;AUTO_INCREMENT,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product_id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>active`</span></span><span>&nbsp;</span><span class="storage type sql"><span>TINYINT</span></span><span>(</span><span class="constant numeric sql"><span>1</span></span><span>)</span><span>&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="constant numeric sql"><span>0</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>start_date`</span></span><span>&nbsp;DATETIME&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>end_date`</span></span><span>&nbsp;DATETIME&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>price`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>PRIMARY&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_product_id`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product_id`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_start_date`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>start_date`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_end_date`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>end_date`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>CONSTRAINT</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>fk_product_sale_product_id`</span></span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>FOREIGN&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product_id`</span></span><span>)</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>REFERENCES</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>))</span></span></div><div class="line"><span class="source sql"><span>ENGINE&nbsp;</span><span class="keyword operator comparison sql"><span>=</span></span><span>&nbsp;InnoDB;</span></span></div><div class="line"><span class="source sql"><span>&nbsp;</span></span></div><div class="line"><span class="source sql"><span class="comment block c"><span class="punctuation definition comment sql"><span>/*</span></span><span>&nbsp;Order&nbsp;Product&nbsp;Line</span><span class="punctuation definition comment sql"><span>*/</span></span></span></span></div><div class="line"><span class="source sql"><span class="meta create sql"><span class="keyword other create sql"><span>CREATE</span></span><span>&nbsp;</span><span class="keyword other sql"><span>TABLE</span></span><span>&nbsp;</span><span class="entity name function sql"><span>IF</span></span></span><span>&nbsp;NOT&nbsp;EXISTS&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>order_product_line`</span></span><span>&nbsp;(</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>&nbsp;AUTO_INCREMENT,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>order_id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product_sale_id`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;UNSIGNED&nbsp;</span><span class="keyword other DDL create II sql"><span>NOT&nbsp;NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>quantity`</span></span><span>&nbsp;</span><span class="storage type sql"><span>INT</span></span><span>(</span><span class="constant numeric sql"><span>11</span></span><span>)&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>&nbsp;DEFAULT&nbsp;</span><span class="keyword other DDL create II sql"><span>NULL</span></span><span>,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>PRIMARY&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_order_id`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>order_id`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;INDEX&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>idx_product_sale_id`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product_sale_id`</span></span><span>&nbsp;</span><span class="keyword other order sql"><span>ASC</span></span><span>)&nbsp;,</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>CONSTRAINT</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>fk_order_product_line_order_id`</span></span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>FOREIGN&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>order_id`</span></span><span>)</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>REFERENCES</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>order`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>),</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;</span><span class="storage modifier sql"><span>CONSTRAINT</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>fk_order_product_line_product_sale_id`</span></span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>FOREIGN&nbsp;KEY</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product_sale_id`</span></span><span>)</span></span></div><div class="line"><span class="source sql"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier sql"><span>REFERENCES</span></span><span>&nbsp;</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>product_sale`</span></span><span>&nbsp;(</span><span class="string quoted other backtick sql"><span class="punctuation definition string begin sql"><span>`</span></span><span>id`</span></span><span>))</span></span></div><div class="line"><span class="source sql"><span>ENGINE&nbsp;</span><span class="keyword operator comparison sql"><span>=</span></span><span>&nbsp;InnoDB;</span></span></div></pre>
<p>Now we need to create entities to map the newly created tables. Fortunately, Doctrine comes with a set of useful commands, you can take a look at them in the <strong>doctrine</strong> namespace when you run <code>app/console</code>. Today we are going to use some of them.</p>
<p>Import the database schema and create entities for each table.</p>
<pre class="editor-colors lang-bash"><div class="line"><span class="source shell"><span>$&nbsp;app/console&nbsp;doctrine:mapping:import&nbsp;AppBundle&nbsp;annotation</span></span></div><div class="line"><span class="source shell"><span>Importing&nbsp;mapping&nbsp;information&nbsp;from&nbsp;</span><span class="string quoted double shell"><span class="punctuation definition string begin shell"><span>&quot;</span></span><span>default</span><span class="punctuation definition string end shell"><span>&quot;</span></span></span><span>&nbsp;entity&nbsp;manager</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;writing&nbsp;/home/ubuntu/web/symfony-tutorial/src/AppBundle/Entity/Address.php</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;writing&nbsp;/home/ubuntu/web/symfony-tutorial/src/AppBundle/Entity/Category.php</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;writing&nbsp;/home/ubuntu/web/symfony-tutorial/src/AppBundle/Entity/Country.php</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;writing&nbsp;/home/ubuntu/web/symfony-tutorial/src/AppBundle/Entity/Customer.php</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;writing&nbsp;/home/ubuntu/web/symfony-tutorial/src/AppBundle/Entity/Order.php</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;writing&nbsp;/home/ubuntu/web/symfony-tutorial/src/AppBundle/Entity/OrderProductLine.php</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;writing&nbsp;/home/ubuntu/web/symfony-tutorial/src/AppBundle/Entity/Product.php</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;writing&nbsp;/home/ubuntu/web/symfony-tutorial/src/AppBundle/Entity/ProductSale.php</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;writing&nbsp;/home/ubuntu/web/symfony-tutorial/src/AppBundle/Entity/ProductStock.php</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;writing&nbsp;/home/ubuntu/web/symfony-tutorial/src/AppBundle/Entity/Warehouse.php</span></span></div></pre>
<p>From the doctrine <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/tools.html#reverse-engineering">documentation</a>:</p>
<blockquote>
<p>Reverse Engineering is a one-time process that can get you started with a project. Converting an existing database schema into mapping files only detects about 70-80% of the necessary mapping information. Additionally the detection from an existing database cannot detect inverse associations, inheritance types, entities with foreign keys as primary keys and many of the semantical operations on associations such as cascade.</p>
</blockquote>
<p>This means that the <code>mapping:import</code> command (and most of automatic code generation tools) should be considered as a helper, not a replacement for you. So we will need some work to get our mapping informations match the database schema.</p>
<ul>
<li>Add <code>options={&quot;unsigned&quot;=true}</code> to all primary keys.<blockquote>
<p><code>unsigned</code> is not standard SQL and few database servers support it. Since we decided to use MySQL for this project, we are going to use, whenever appropriate, specific MySQL features.</p>
</blockquote>
</li>
<li>Add <code>options={&quot;default&quot;=0}</code> to Category::deleted and ProductSale::active and ProductStock::quantity</li>
<li>Add <code>nullable=false</code> to non nullable foreign keys.</li>
</ul>
<p>To make sure the mapping matches the database, you can run the command</p>
<pre class="editor-colors lang-bash"><div class="line"><span class="source shell"><span>$&nbsp;app/console&nbsp;doctrine:schema:validate</span></span></div><div class="line"><span class="source shell"><span>[Mapping]&nbsp;&nbsp;OK&nbsp;-&nbsp;The&nbsp;mapping&nbsp;files&nbsp;are&nbsp;correct.</span></span></div><div class="line"><span class="source shell"><span>[Database]&nbsp;OK&nbsp;-&nbsp;The&nbsp;database&nbsp;schema&nbsp;is&nbsp;</span><span class="keyword control shell"><span>in</span></span><span>&nbsp;sync&nbsp;with&nbsp;the&nbsp;mapping&nbsp;files.</span></span></div></pre>
<p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></p>
<h2 id="3-2-entity-accessors">3.2 Entity accessors</h2>
<p>The previous command generated the required entities, but without members accessors. We can also generate setters and getters for all the entities using the following command.</p>
<pre class="editor-colors lang-bash"><div class="line"><span class="source shell"><span>$&nbsp;app/console&nbsp;doctrine:generate:entities&nbsp;AppBundle&nbsp;--no-backup</span></span></div><div class="line"><span class="source shell"><span>Generating&nbsp;entities&nbsp;</span><span class="meta scope for-in-loop shell"><span class="keyword control shell"><span>for</span></span><span>&nbsp;</span><span class="variable other loop shell"><span>bundle</span></span><span>&nbsp;</span><span class="string quoted double shell"><span class="punctuation definition string begin shell"><span>&quot;</span></span><span>AppBundle</span><span class="punctuation definition string end shell"><span>&quot;</span></span></span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;generating&nbsp;AppBundle</span><span class="constant character escape shell"><span>\E</span></span><span>ntity</span><span class="constant character escape shell"><span>\A</span></span><span>ddress</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;generating&nbsp;AppBundle</span><span class="constant character escape shell"><span>\E</span></span><span>ntity</span><span class="constant character escape shell"><span>\O</span></span><span>rderProductLine</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;generating&nbsp;AppBundle</span><span class="constant character escape shell"><span>\E</span></span><span>ntity</span><span class="constant character escape shell"><span>\C</span></span><span>ategory</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;generating&nbsp;AppBundle</span><span class="constant character escape shell"><span>\E</span></span><span>ntity</span><span class="constant character escape shell"><span>\P</span></span><span>roduct</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;generating&nbsp;AppBundle</span><span class="constant character escape shell"><span>\E</span></span><span>ntity</span><span class="constant character escape shell"><span>\P</span></span><span>roductSale</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;generating&nbsp;AppBundle</span><span class="constant character escape shell"><span>\E</span></span><span>ntity</span><span class="constant character escape shell"><span>\C</span></span><span>ustomer</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;generating&nbsp;AppBundle</span><span class="constant character escape shell"><span>\E</span></span><span>ntity</span><span class="constant character escape shell"><span>\P</span></span><span>roductStock</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;generating&nbsp;AppBundle</span><span class="constant character escape shell"><span>\E</span></span><span>ntity</span><span class="constant character escape shell"><span>\W</span></span><span>arehouse</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;generating&nbsp;AppBundle</span><span class="constant character escape shell"><span>\E</span></span><span>ntity</span><span class="constant character escape shell"><span>\O</span></span><span>rder</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>&nbsp;&nbsp;</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;generating&nbsp;AppBundle</span><span class="constant character escape shell"><span>\E</span></span><span>ntity</span><span class="constant character escape shell"><span>\C</span></span><span>ountry</span></span></span></div></pre>
<p>Again, we will inspect the generated code and adjust it as needed.</p>
<ul>
<li>Remove <code>addCustomer</code>, <code>removeCustomer</code> and <code>getCustomer</code> methods from Address entity.</li>
<li>Remove <code>addProduct</code>, <code>removeProduct</code> and <code>getProduct</code> methods from Category entity.</li>
<li>Rename the member <code>category</code> to <code>categories</code> and <code>getCategory</code> to <code>getCategories</code> in Product entity</li>
<li>Add <code>setCategories</code> method to Product entity<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span>/**</span></span></div><div class="line"><span class="text html php"><span>*&nbsp;Add&nbsp;category</span></span></div><div class="line"><span class="text html php"><span>*&nbsp;@param&nbsp;\AppBundle\Entity\Category&nbsp;$categories</span></span></div><div class="line"><span class="text html php"><span>*&nbsp;@return&nbsp;Product</span></span></div><div class="line"><span class="text html php"><span>*/</span></span></div><div class="line"><span class="text html php"><span>public&nbsp;function&nbsp;setCategories(</span></span></div><div class="line"><span class="text html php"><span>\Doctrine\Common\Collections\ArrayCollection&nbsp;$categories</span></span></div><div class="line"><span class="text html php"><span>)</span></span></div><div class="line"><span class="text html php"><span>{</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;$this-&gt;categories&nbsp;=&nbsp;$categories;</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;return&nbsp;$this;</span></span></div><div class="line"><span class="text html php"><span>}</span></span></div></pre>
</li>
<li><p>Change <code>inversedBy=&quot;category&quot;</code> to <code>inversedBy=&quot;categories&quot;</code> in the ManyToMany mapping on Category::product</p>
</li>
<li><p>Change <code>setParent</code> to <code>setParentCategory</code> in src/AppBundle/DataFixtures/ORM/CategoryFixtures.php L 56</p>
</li>
<li>Change <code>parent</code> occurrences to <code>parentCategory</code> in src/AppBundle/Form/Type/CategoryType.php</li>
<li>Add <code>const REPOSITORY = &#39;AppBundle:Entity&#39;</code> to all entities (change <code>Entity</code> to the entity name)</li>
</ul>
<p>We are done.</p>
<h2 id="3-3-basic-crud-for-country-entity">3.3 Basic CRUD for Country entity</h2>
<p>SensioGeneratorBundle is part of Symfony standard edition and provides a command to automatically generate CRUD actions from an entity. Let&#39;s see it in action.</p>
<pre class="editor-colors lang-bash"><div class="line"><span class="source shell"><span>$&nbsp;app/console&nbsp;doctrine:generate:crud&nbsp;--with-write&nbsp;--entity=AppBundle:Country&nbsp;\</span></span></div><div class="line"><span class="source shell"><span>--format=yml&nbsp;--no-interaction</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;CRUD&nbsp;generation&nbsp;&nbsp;</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>Generating&nbsp;the&nbsp;CRUD&nbsp;code:&nbsp;OK</span></span></div><div class="line"><span class="source shell"><span>Generating&nbsp;the&nbsp;Form&nbsp;code:&nbsp;OK</span></span></div><div class="line"><span class="source shell"><span>Importing&nbsp;the&nbsp;CRUD&nbsp;routes:&nbsp;OK</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;You&nbsp;can&nbsp;now&nbsp;start&nbsp;using&nbsp;the&nbsp;generated&nbsp;code</span><span class="keyword operator pipe shell"><span>!</span></span></span></div></pre>
<p>The command generated the following commands, you are advised to inspect them all</p>
<ul>
<li><strong>src/AppBundle/Controller/CountryController.php</strong>  with index, show, new, create, edit, and update actions.</li>
<li><strong>src/AppBundle/Form/CountryType.php</strong> Form type</li>
<li><strong>src/AppBundle/Resources/config/routing/country.yml</strong> contains routes definition for country actions.</li>
<li><strong>src/AppBundle/Resources/views/Country/index|show|edit|new.html.twig</strong> are basic Twig templates to render the different actions.</li>
<li><p><strong>src/AppBundle/Tests/Controller/CountryControllerTest.php</strong> Contains a commented skeleton for a test suite.</p>
</li>
<li><p><strong>src/AppBundle/Resources/config/routing.yml</strong> was updated to include the newly created country.yml routes configuration file.</p>
</li>
</ul>
<p>Let&#39;s try to see what tests were generated. Edit <strong>src/AppBundle/Tests/Controller/CountryControllerTest.php</strong> and uncomment the only method.<br>The generated test is just a skeleton and doesn&#39;t work out of the box. We need to tweak it a bit.</p>
<p>Update the form creation after <code>// Fill in the form and submit it</code> to  </p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>$form&nbsp;=&nbsp;$crawler-&gt;selectButton(&#39;Create&#39;)-&gt;form(array(</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&#39;appbundle_country[code]&#39;&nbsp;=&gt;&nbsp;&#39;Test&#39;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&#39;appbundle_country[name]&#39;&nbsp;=&gt;&nbsp;&#39;Test&#39;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&#39;appbundle_country[currency]&#39;&nbsp;=&gt;&nbsp;&#39;Test&#39;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>));</span></span></span></div></pre><p>Update the line 37 to set a <code>code</code> field instead of <code>field_name</code> <code>&#39;appbundle_country[code]&#39; =&gt; &#39;Foo&#39;,</code></p>
<p>We noticed an old test at <strong>src/AppBundle/Tests/Controller/DefaultControllerTest.php</strong>, delete that file. Also delete <strong>src/AppBundle/Controller/DefaultController.php</strong></p>
<p>Let&#39;s run the test suite</p>
<pre class="editor-colors lang-bash"><div class="line"><span class="source shell"><span>$&nbsp;phpunit&nbsp;-c&nbsp;app</span></span></div><div class="line"><span class="source shell"><span>PHPUnit&nbsp;3.7.28&nbsp;by&nbsp;Sebastian&nbsp;Bergmann.</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>Configuration&nbsp;</span><span class="support function builtin shell"><span>read</span></span><span>&nbsp;from&nbsp;/home/ubuntu/web/symfony-tutorial/app/phpunit.xml.dist</span></span></div><div class="line"><span class="source shell"><span class="support function builtin shell"><span>.</span></span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>Time:&nbsp;2.92&nbsp;seconds,&nbsp;Memory:&nbsp;19.25Mb</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>OK&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>1&nbsp;</span><span class="support function builtin shell"><span>test</span></span><span>,&nbsp;4&nbsp;assertions</span><span class="punctuation definition subshell shell"><span>)</span></span></span></span></div></pre>
<p><br></p>
<p>To get a coverage report from phpunit, you can add a <strong>--coverage-text</strong> argument</p>
<pre class="editor-colors lang-bash"><div class="line"><span class="source shell"><span>$&nbsp;phpunit&nbsp;-c&nbsp;app&nbsp;--coverage-text</span></span></div><div class="line"><span class="source shell"><span>PHPUnit&nbsp;3.7.28&nbsp;by&nbsp;Sebastian&nbsp;Bergmann.</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>Configuration&nbsp;</span><span class="support function builtin shell"><span>read</span></span><span>&nbsp;from&nbsp;/home/ubuntu/web/symfony-tutorial/app/phpunit.xml.dist</span></span></div><div class="line"><span class="source shell"><span class="support function builtin shell"><span>.</span></span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>Time:&nbsp;9.05&nbsp;seconds,&nbsp;Memory:&nbsp;19.25Mb</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>OK&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>1&nbsp;</span><span class="support function builtin shell"><span>test</span></span><span>,&nbsp;4&nbsp;assertions</span><span class="punctuation definition subshell shell"><span>)</span></span></span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>Code&nbsp;Coverage&nbsp;Report</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;2015-10-04&nbsp;00:24:13</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>&nbsp;Summary:</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;Classes:&nbsp;14.29%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>3/21</span><span class="punctuation definition subshell shell"><span>)</span></span></span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;Methods:&nbsp;10.20%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>15/147</span><span class="punctuation definition subshell shell"><span>)</span></span></span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;Lines:&nbsp;&nbsp;&nbsp;12.42%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>97/781</span><span class="punctuation definition subshell shell"><span>)</span></span></span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span class="constant character escape shell"><span>\A</span></span><span>ppBundle</span><span class="constant character escape shell"><span>\C</span></span><span>ontroller::CountryController</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;Methods:&nbsp;100.00%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>10/10</span><span class="punctuation definition subshell shell"><span>)</span></span></span><span>&nbsp;&nbsp;&nbsp;Lines:&nbsp;&nbsp;85.06%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>&nbsp;74/&nbsp;87</span><span class="punctuation definition subshell shell"><span>)</span></span></span></span></div><div class="line"><span class="source shell"><span class="constant character escape shell"><span>\A</span></span><span>ppBundle</span><span class="constant character escape shell"><span>\E</span></span><span>ntity::Country</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;Methods:&nbsp;100.00%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>&nbsp;7/&nbsp;7</span><span class="punctuation definition subshell shell"><span>)</span></span></span><span>&nbsp;&nbsp;&nbsp;Lines:&nbsp;100.00%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>&nbsp;10/&nbsp;10</span><span class="punctuation definition subshell shell"><span>)</span></span></span></span></div><div class="line"><span class="source shell"><span class="constant character escape shell"><span>\A</span></span><span>ppBundle</span><span class="constant character escape shell"><span>\E</span></span><span>vent</span><span class="constant character escape shell"><span>\L</span></span><span>istener::SoftDelete</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;Methods:&nbsp;100.00%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>&nbsp;1/&nbsp;1</span><span class="punctuation definition subshell shell"><span>)</span></span></span><span>&nbsp;&nbsp;&nbsp;Lines:&nbsp;&nbsp;41.67%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>&nbsp;&nbsp;5/&nbsp;12</span><span class="punctuation definition subshell shell"><span>)</span></span></span></span></div><div class="line"><span class="source shell"><span class="constant character escape shell"><span>\A</span></span><span>ppBundle</span><span class="constant character escape shell"><span>\F</span></span><span>orm::CountryType</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;Methods:&nbsp;100.00%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>&nbsp;3/&nbsp;3</span><span class="punctuation definition subshell shell"><span>)</span></span></span><span>&nbsp;&nbsp;&nbsp;Lines:&nbsp;100.00%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>&nbsp;&nbsp;8/&nbsp;&nbsp;8</span><span class="punctuation definition subshell shell"><span>)</span></span></span></span></div></pre>
<p><br></p>
<blockquote>
<p>What&#39;s the deal with functional tests? If you are reading this book, most probably you are familiar with automated testing. A detailed study about testing benefits and techniques is out of the scope of this material. There are plenty of books and on-line resources about the subject. Here we will just comment on our example, and we will continue writing more functional and unit tests.</p>
</blockquote>
<p>The CRUD generate command generated a functional tests suite for us, that basically does the following:</p>
<ul>
<li>Visited the countries index page</li>
<li>Created a new country</li>
<li>Updated the created country</li>
<li>Deleted the created country</li>
</ul>
<p>Alternatively, we could fire up a web browser and check manually that the code works as expected by submitting forms and clicking on links. Having automated tests helps us test the application faster, get reproducible results, be able to automatically test any code change and catch bugs earlier in development cycle.</p>
<p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></p>
<h2 id="3-4-override-default-crud-templates">3.4 Override default CRUD templates</h2>
<p>The generate:crud command did pretty much a good job. Not perfect though, we can already spot few issues  </p>
<ul>
<li>We don&#39;t want the generated tests to be commented.</li>
<li>The <code>testCompleteScenario</code> is testing all the actions, would be better to split it in separate test methods for each action.</li>
</ul>
<p>It is easy to update the generated code to meet those requirements. The changes we want to make doesn&#39;t seem to be related to the Country entity, and we will probably need them for most of the generated entities. Our approach will be to change the way the code is generated. This way we will have those changes propagate to all the generated actions.</p>
<ul>
<li>Create <strong>app/Resources/SensioGeneratorBundle/skeleton/crud/tests/test.php.twig</strong></li>
</ul>
<pre class="editor-colors lang-html"><div class="line"><span class="text html basic"><span>{%&nbsp;extends&nbsp;&quot;skeleton/crud/tests/test.php.twig&quot;&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;</span></span></div><div class="line"><span class="text html basic"><span>{%&nbsp;block&nbsp;class_body&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;&nbsp;&nbsp;&nbsp;{%-&nbsp;if&nbsp;&#39;new&#39;&nbsp;in&nbsp;actions&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{%-&nbsp;include&nbsp;&#39;crud/tests/others/full_scenario.php.twig&#39;&nbsp;-%}</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;&nbsp;&nbsp;&nbsp;{%-&nbsp;else&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{%-&nbsp;include&nbsp;&#39;crud/tests/others/short_scenario.php.twig&#39;&nbsp;-%}</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;&nbsp;&nbsp;&nbsp;{%-&nbsp;endif&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>{%&nbsp;endblock&nbsp;class_body&nbsp;%}</span></span></div></pre>
<p>Let&#39;s take a quick look at the template we are extending from, is located at <strong>vendor/sensio/generator-bundle/Sensio/Bundle/GeneratorBundle/Resources/skeleton/crud/tests/test.php.twig</strong></p>
<pre class="editor-colors lang-html"><div class="line"><span class="text html basic"><span>&lt;?php</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;</span></span></div><div class="line"><span class="text html basic"><span>namespace&nbsp;{{&nbsp;namespace&nbsp;}}\Tests\Controller{{&nbsp;entity_namespace&nbsp;?&nbsp;&#39;\\&#39;~entity_namespace:&#39;&#39;}};</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;</span></span></div><div class="line"><span class="text html basic"><span>{%&nbsp;block&nbsp;use_statements&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>use&nbsp;Symfony\Bundle\FrameworkBundle\Test\WebTestCase;</span></span></div><div class="line"><span class="text html basic"><span>{%&nbsp;endblock&nbsp;use_statements&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;</span></span></div><div class="line"><span class="text html basic"><span>{%&nbsp;block&nbsp;class_definition&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>class&nbsp;{{&nbsp;entity_class&nbsp;}}ControllerTest&nbsp;extends&nbsp;WebTestCase</span></span></div><div class="line"><span class="text html basic"><span>{%&nbsp;endblock&nbsp;class_definition&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>{</span></span></div><div class="line"><span class="text html basic"><span>{%&nbsp;block&nbsp;class_body&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;&nbsp;&nbsp;&nbsp;/*</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;</span></span></div><div class="line"><span class="text html basic"><span>{%-&nbsp;if&nbsp;&#39;new&#39;&nbsp;in&nbsp;actions&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;&nbsp;&nbsp;&nbsp;{%-&nbsp;include&nbsp;&#39;crud/tests/others/full_scenario.php.twig&#39;&nbsp;-%}</span></span></div><div class="line"><span class="text html basic"><span>{%-&nbsp;else&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;&nbsp;&nbsp;&nbsp;{%-&nbsp;include&nbsp;&#39;crud/tests/others/short_scenario.php.twig&#39;&nbsp;-%}</span></span></div><div class="line"><span class="text html basic"><span>{%-&nbsp;endif&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;</span></span></div><div class="line"><span class="text html basic"><span>&nbsp;&nbsp;&nbsp;&nbsp;*/</span></span></div><div class="line"><span class="text html basic"><span>{%&nbsp;endblock&nbsp;class_body&nbsp;%}</span></span></div><div class="line"><span class="text html basic"><span>}</span></span></div></pre>
<p>We are just overriding the <strong>class_body</strong> block and removed the comment tags <code>/* */</code>. To see the result of this change, we need to run the generate command again. Now we need to add the <strong>--overwrite</strong> option so it won&#39;t complain about existing files.</p>
<pre class="editor-colors lang-bash"><div class="line"><span class="source shell"><span>$&nbsp;app/console&nbsp;doctrine:generate:crud&nbsp;--with-write&nbsp;--entity=AppBundle:Country&nbsp;\</span></span></div><div class="line"><span class="source shell"><span>&nbsp;--format=yml&nbsp;--no-interaction&nbsp;--overwrite</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;CRUD&nbsp;generation&nbsp;&nbsp;</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>Generating&nbsp;the&nbsp;CRUD&nbsp;code:&nbsp;OK</span></span></div><div class="line"><span class="source shell"><span>Generating&nbsp;the&nbsp;Form&nbsp;code:&nbsp;Already&nbsp;exists,&nbsp;skipping</span></span></div><div class="line"><span class="source shell"><span>Importing&nbsp;the&nbsp;CRUD&nbsp;routes:&nbsp;FAILED</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;The&nbsp;</span><span class="support function builtin shell"><span>command</span></span><span>&nbsp;was&nbsp;not&nbsp;able&nbsp;to&nbsp;configure&nbsp;everything&nbsp;automatically.&nbsp;&nbsp;</span></span></div><div class="line"><span class="source shell"><span>&nbsp;&nbsp;You&nbsp;must&nbsp;</span><span class="keyword control shell"><span>do</span></span><span>&nbsp;the&nbsp;following&nbsp;changes&nbsp;manually.</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>-&nbsp;Import&nbsp;the&nbsp;bundle</span><span class="string quoted single shell"><span class="punctuation definition string begin shell"><span>&#39;</span></span><span>s&nbsp;routing&nbsp;resource&nbsp;in&nbsp;the&nbsp;bundle&nbsp;routing&nbsp;file</span></span></span></div><div class="line"><span class="source shell"><span class="string quoted single shell"><span>&nbsp;&nbsp;(/home/ubuntu/web/symfony-tutorial/src/AppBundle/Resources/config/routing.yml).</span></span></span></div><div class="line"><span class="source shell"><span class="string quoted single shell"><span>&nbsp;</span></span></span></div><div class="line"><span class="source shell"><span class="string quoted single shell"><span>&nbsp;&nbsp;&nbsp;&nbsp;AppBundle_country:</span></span></span></div><div class="line"><span class="source shell"><span class="string quoted single shell"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resource:&nbsp;&quot;@AppBundle/Resources/config/routing/country.yml&quot;</span></span></span></div><div class="line"><span class="source shell"><span class="string quoted single shell"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefix:&nbsp;&nbsp;&nbsp;/country</span></span></span></div></pre>
<p>If you inspect <strong>src/AppBundle/Tests/Controller/CountryControllerTest.php</strong> you will notice that the test is not commented anymore.  </p>
<p>We are not done yet. We need to generate several tests for each action. We will override the <strong>full_scenario.php.twig</strong> template.</p>
<ul>
<li>Create <strong>app/Resources/SensioGeneratorBundle/skeleton/crud/tests/others/full_scenario.php.twig</strong></li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{%-&nbsp;set&nbsp;formType&nbsp;=&nbsp;&nbsp;form_type_name|lower&nbsp;%}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>public&nbsp;function&nbsp;testIndexAction()</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$client&nbsp;=&nbsp;static::createClient();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;$crawler&nbsp;=&nbsp;$client-&gt;request(&#39;GET&#39;,&nbsp;&#39;/{{&nbsp;route_prefix&nbsp;}}/&#39;);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;$unexpectedStatus&nbsp;=&nbsp;&quot;Unexpected&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;for&nbsp;GET&nbsp;/{{&nbsp;route_prefix&nbsp;}}/&quot;;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;assertEquals(200,&nbsp;$client-&gt;getResponse()-&gt;getStatusCode(),&nbsp;$unexpectedStatus);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>public&nbsp;function&nbsp;testNewAction()</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$client&nbsp;=&nbsp;static::createClient();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;$crawler&nbsp;=&nbsp;$this-&gt;createNewEntity($client,&nbsp;&#39;/{{route_prefix}}/&#39;,&nbsp;&#39;{{formType}}&#39;);</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>foreach&nbsp;($this-&gt;getNewFormFields()&nbsp;as&nbsp;$value)&nbsp;{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$missingElementError&nbsp;=&nbsp;sprintf(&#39;Missing&nbsp;element&nbsp;td:contains(&quot;%s&quot;)&#39;,&nbsp;$value);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$valueCount&nbsp;=&nbsp;$crawler-&gt;filter(sprintf(&#39;td:contains(&quot;%s&quot;)&#39;,&nbsp;$value))-&gt;count();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;assertGreaterThan(0,&nbsp;$valueCount,&nbsp;$missingElementError);</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>public&nbsp;function&nbsp;testUpdateAction()</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$client&nbsp;=&nbsp;static::createClient();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;$crawler&nbsp;=&nbsp;$this-&gt;createNewEntity($client,&nbsp;&#39;/{{route_prefix}}/&#39;,&nbsp;&#39;{{formType}}&#39;);</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$crawler&nbsp;=&nbsp;$client-&gt;click($crawler-&gt;selectLink(&#39;Edit&#39;)-&gt;link());</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$formFields&nbsp;=&nbsp;$this-&gt;getUpdateFormFields();</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$form&nbsp;=&nbsp;$crawler-&gt;selectButton(&#39;Update&#39;)-&gt;form(</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$this-&gt;constructFormValues($formFields,&nbsp;&#39;{{formType}}&#39;)</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>);</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$client-&gt;submit($form);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;$crawler&nbsp;=&nbsp;$client-&gt;followRedirect();</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>foreach&nbsp;($this-&gt;getUpdateFormFields()&nbsp;as&nbsp;$value)&nbsp;{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$missingElementError&nbsp;=&nbsp;sprintf(&#39;Missing&nbsp;element&nbsp;td:contains(&quot;%s&quot;)&#39;,&nbsp;$value);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$valueCount&nbsp;=&nbsp;$crawler-&gt;filter(sprintf(&#39;[value=&quot;%s&quot;]&#39;,&nbsp;$value))-&gt;count();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;assertGreaterThan(0,&nbsp;$valueCount,&nbsp;$missingElementError);</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>/**</span></span></span></div><div class="line"><span class="text plain"><span class="meta bullet-point star text"><span>&nbsp;</span><span class="punctuation definition item text"><span>*</span></span><span>&nbsp;</span></span></span></div><div class="line"><span class="text plain"><span class="meta bullet-point star text"><span>&nbsp;</span><span class="punctuation definition item text"><span>*</span></span><span>&nbsp;@return&nbsp;array&nbsp;&#39;field_name&#39;=&gt;&#39;value&#39;&nbsp;to&nbsp;be&nbsp;used&nbsp;for&nbsp;testNewAction</span></span></span></div><div class="line"><span class="text plain"><span class="meta bullet-point star text"><span>&nbsp;</span><span class="punctuation definition item text"><span>*</span></span><span>/</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>protected&nbsp;function&nbsp;getNewFormFields()</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>return&nbsp;array(</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&#39;field_name&#39;&nbsp;=&gt;&nbsp;&#39;value&#39;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//other&nbsp;fields</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>/**</span></span></span></div><div class="line"><span class="text plain"><span class="meta bullet-point star text"><span>&nbsp;</span><span class="punctuation definition item text"><span>*</span></span><span>&nbsp;</span></span></span></div><div class="line"><span class="text plain"><span class="meta bullet-point star text"><span>&nbsp;</span><span class="punctuation definition item text"><span>*</span></span><span>&nbsp;@return&nbsp;array&nbsp;&#39;field_name&#39;=&gt;&#39;value&#39;&nbsp;to&nbsp;be&nbsp;used&nbsp;for&nbsp;testUpdateAction</span></span></span></div><div class="line"><span class="text plain"><span class="meta bullet-point star text"><span>&nbsp;</span><span class="punctuation definition item text"><span>*</span></span><span>/</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>protected&nbsp;function&nbsp;getUpdateFormFields()</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>return&nbsp;$this-&gt;getNewFormFields();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>protected&nbsp;function&nbsp;constructFormValues($fields,&nbsp;$formTypeName)</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$values&nbsp;=&nbsp;array();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;($fields&nbsp;as&nbsp;$fieldName&nbsp;=&gt;&nbsp;$value)&nbsp;{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$values[sprintf(&#39;%s[%s]&#39;,&nbsp;$formTypeName,&nbsp;$fieldName)]&nbsp;=&nbsp;$value;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$values;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>protected&nbsp;function&nbsp;createNewEntity(Client&nbsp;$client,&nbsp;$routePrefix,&nbsp;$formTypeName)</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$crawler&nbsp;=&nbsp;$client-&gt;request(&#39;GET&#39;,&nbsp;$routePrefix);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;$crawler&nbsp;=&nbsp;$client-&gt;click($crawler-&gt;selectLink(&#39;Create&nbsp;a&nbsp;new&nbsp;entry&#39;)-&gt;link());</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$form&nbsp;=&nbsp;$crawler-&gt;selectButton(&#39;Create&#39;)-&gt;form(</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$this-&gt;constructFormValues($this-&gt;getNewFormFields(),&nbsp;$formTypeName)</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>);</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$client-&gt;submit($form);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$client-&gt;followRedirect();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><blockquote>
<p>Although this is a template to generate code, we must think about the maintainability of the generated code as well. We declared some reusable methods as protected. We are preparing to move those methods to a parent class and override them whenever required.</p>
</blockquote>
<p>The method <code>createNewEntity</code> expects an object of type Symfony\Component\HttpKernel\Client. We will add the required use statement to the <strong>test.php.twig</strong> template.</p>
<ul>
<li>Edit <strong>app/Resources/SensioGeneratorBundle/skeleton/crud/tests/test.php.twig</strong> add the following block right after the <code>extends</code> tag  <pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{%&nbsp;block&nbsp;use_statements&nbsp;%}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{{&nbsp;parent()&nbsp;}}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>use&nbsp;Symfony\Component\HttpKernel\Client;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{%&nbsp;endblock&nbsp;use_statements&nbsp;%}</span></span></span></div></pre></li>
</ul>
<p>Execute the generate:crud command again and inspect the generated CountryControllerTest. It should look better than before. All we need to do now is to update the return value of <code>getNewFormFields</code> to return some valid values.</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>protected&nbsp;function&nbsp;getNewFormFields()</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>return&nbsp;array(</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&#39;code&#39;&nbsp;=&gt;&nbsp;&#39;code&#39;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;name&#39;&nbsp;=&gt;&nbsp;&#39;name&#39;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;currency&#39;&nbsp;=&gt;&nbsp;&#39;eur&#39;,</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><p>Let&#39;s run the tests again and see what happens.</p>
<pre class="editor-colors lang-bash"><div class="line"><span class="source shell"><span>$&nbsp;phpunit&nbsp;-c&nbsp;app</span></span></div><div class="line"><span class="source shell"><span>PHPUnit&nbsp;3.7.28&nbsp;by&nbsp;Sebastian&nbsp;Bergmann.</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>Configuration&nbsp;</span><span class="support function builtin shell"><span>read</span></span><span>&nbsp;from&nbsp;/home/ubuntu/web/symfony-tutorial/app/phpunit.xml.dist</span></span></div><div class="line"><span class="source shell"><span>...</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>Time:&nbsp;2.96&nbsp;seconds,&nbsp;Memory:&nbsp;19.25Mb</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>OK&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>3&nbsp;tests,&nbsp;7&nbsp;assertions</span><span class="punctuation definition subshell shell"><span>)</span></span></span></span></div></pre>
<p>Perfect! Now we have 3 tests and 7 assertions instead of one test and 4 assertions. The more our tests are granular, the easier it will be to spot problems if a test fails. To know that <strong>testUpdateAction</strong> failed is definitely better than knowing that <strong>testCompleteScenario</strong> failed.</p>
<p><br><br><br><br><br><br><br><br><br><br><br><br></p>
<h2 id="3-5-pagination">3.5 Pagination</h2>
<p>Whenever displaying lists of data, you should limit the number of records to show. Ideally, you should limit the number of records you retrieve at once from the data storage. Failing to do so can have undesirable consequences like crashing the user&#39;s browser, unnecessary usage of the network bandwidth, and eventually putting your data storage to do more work than required.</p>
<p>Let&#39;s implement pagination for the Country index action.</p>
<ul>
<li>Edit <strong>src/AppBundle/Controller/CountryController.php</strong> and update <code>indexAction</code> as following</li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span class="punctuation definition comment php"><span>/**</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;*&nbsp;Lists&nbsp;Country&nbsp;entities&nbsp;per&nbsp;page.</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;*</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>indexAction</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>page</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="constant numeric php"><span>1</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>recordsPerPage</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="constant numeric php"><span>10</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>manager</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getDoctrine</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getManager</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>dql</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="support function string php"><span>sprintf</span></span><span>(</span><span class="string quoted single sql php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="source sql embedded php"><span class="keyword other DML sql"><span>SELECT</span></span><span>&nbsp;e&nbsp;</span><span class="keyword other DML sql"><span>from</span></span><span>&nbsp;%s&nbsp;e</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,</span><span>&nbsp;</span><span class="support class php"><span>Country</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>REPOSITORY</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>query</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>manager</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>createQuery</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>dql</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setFirstResult</span></span><span>(</span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>page</span></span><span>&nbsp;</span><span class="keyword operator arithmetic php"><span>-</span></span><span>&nbsp;</span><span class="constant numeric php"><span>1</span></span><span>)&nbsp;</span><span class="keyword operator arithmetic php"><span>*</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>recordsPerPage</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setMaxResults</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>recordsPerPage</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>paginator</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support other namespace php"><span class="punctuation separator inheritance php"><span>\</span></span><span>Doctrine</span><span class="punctuation separator inheritance php"><span>\</span></span><span>ORM</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Tools</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Pagination</span><span class="punctuation separator inheritance php"><span>\</span></span></span><span class="support class php"><span>Paginator</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>query</span></span><span>,&nbsp;</span><span class="constant language php"><span>false</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>render</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>AppBundle:Country:index.html.twig</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,&nbsp;</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta array php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>entities</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>paginator</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getIterator</span></span><span>(</span><span class="punctuation definition array end php"><span>)</span></span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>currentPage</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>page</span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>totalPages</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="support function math php"><span>ceil</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>paginator</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>count</span></span><span>(</span><span>)</span><span class="keyword operator arithmetic php"><span>/</span></span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>recordsPerPage</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;))</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p>We passed <code>false</code> as second argument ($fetchJoinCollection) to the <code>Paginator</code> constructor. From the Doctrine documentation, we can read</p>
<blockquote>
<p>By default the pagination extension does the following steps to compute the correct result:</p>
<ul>
<li>Perform a Count query using DISTINCT keyword.</li>
<li>Perform a Limit Subquery with DISTINCT to find all ids of the entity in from on the current page.</li>
<li>Perform a WHERE IN query to get all results for the current page.
This behavior is only necessary if you actually fetch join a to-many collection. You can disable this behavior by setting the $fetchJoinCollection flag to false;</li>
</ul>
</blockquote>
<p><br><br></p>
<p>In simple words, there are two ways to retrieve the data from the database.</p>
<ul>
<li>Fetch all the columns from the database applying a limit and an offset<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>SELECT&nbsp;*&nbsp;FROM&nbsp;country&nbsp;ORDER&nbsp;BY&nbsp;id&nbsp;LIMIT&nbsp;10&nbsp;OFFSET&nbsp;0;</span></span></span></div></pre></li>
<li>Fetch only the primary keys from the database applying a limit and an offset, then fetch all the columns corresponding to those primary keys<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>SELECT&nbsp;id&nbsp;FROM&nbsp;country&nbsp;ORDER&nbsp;BY&nbsp;id&nbsp;LIMIT&nbsp;10&nbsp;OFFSET&nbsp;0</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>SELECT&nbsp;*&nbsp;FROM&nbsp;country&nbsp;WHERE&nbsp;id&nbsp;in&nbsp;(1,2,3,4,5,6,7,8,9,10)</span></span></span></div></pre>There is no general answer to the question &quot;which method is better?&quot;. The performance of the query depends on many factors, like the query itself, the used storage engine, the schema structure, the dataset volume and distribution.. amnog others.
You must benchmark and profile every query in order to decide which approach works better in your situation. Don&#39;t forget that every situation is a special case.</li>
</ul>
<p>As an example, let&#39;s profile the possible queries to see the difference.</p>
<p><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br></p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>#&nbsp;query&nbsp;1</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>mysql&gt;&nbsp;explain&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;country&nbsp;ORDER&nbsp;BY&nbsp;id&nbsp;LIMIT&nbsp;10&nbsp;OFFSET&nbsp;0;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>+--+-----------+---------+-------+---------------+---------+-------+----+------+-------+</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>|id|select_type|&nbsp;table&nbsp;&nbsp;&nbsp;|&nbsp;type&nbsp;&nbsp;|&nbsp;possible_keys&nbsp;|&nbsp;key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|key_len|ref&nbsp;|&nbsp;rows&nbsp;|&nbsp;Extra&nbsp;|</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>+--+-----------+---------+-------+---------------+---------+-------+----+------+-------+</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>|&nbsp;1|&nbsp;SIMPLE&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;country&nbsp;|&nbsp;index&nbsp;|&nbsp;NULL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;PRIMARY&nbsp;|&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|NULL|&nbsp;&nbsp;&nbsp;10&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>+--+-----------+---------+-------+---------------+---------+-------+----+------+-------+</span></span></span></div></pre><pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>#&nbsp;query&nbsp;2</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>mysql&gt;&nbsp;explain&nbsp;SELECT&nbsp;id&nbsp;FROM&nbsp;country&nbsp;ORDER&nbsp;BY&nbsp;id&nbsp;LIMIT&nbsp;10&nbsp;OFFSET&nbsp;0;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>+--+-----------+---------+-------+---------------+---------+-------+----+----+-----------+</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>|id|select_type|&nbsp;table&nbsp;&nbsp;&nbsp;|&nbsp;type&nbsp;&nbsp;|&nbsp;possible_keys&nbsp;|&nbsp;key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|key_len|ref&nbsp;|rows|&nbsp;Extra&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>+--+-----------+---------+-------+---------------+---------+-------+----+----+-----------+</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>|&nbsp;1|&nbsp;SIMPLE&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;country&nbsp;|&nbsp;index&nbsp;|&nbsp;NULL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;PRIMARY&nbsp;|&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|NULL|&nbsp;10&nbsp;|Using&nbsp;index|</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>+--+-----------+---------+-------+---------------+---------+-------+----+----+-----------+</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>#&nbsp;query&nbsp;3</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>mysql&gt;&nbsp;explain&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;country&nbsp;WHERE&nbsp;id&nbsp;in&nbsp;(1,2,3,4,5,6,7,8,9,10);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>+--+-----------+---------+-------+---------------+---------+-------+----+----+-----------+</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>|id|select_type|&nbsp;table&nbsp;&nbsp;&nbsp;|&nbsp;type&nbsp;&nbsp;|&nbsp;possible_keys&nbsp;|&nbsp;key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|key_len|ref&nbsp;|rows|&nbsp;Extra&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>+--+-----------+---------+-------+---------------+---------+-------+----+----+-----------+</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>|&nbsp;1|&nbsp;SIMPLE&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;country&nbsp;|&nbsp;range&nbsp;|&nbsp;PRIMARY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;PRIMARY&nbsp;|&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|NULL|&nbsp;10&nbsp;|Using&nbsp;where|</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>+--+-----------+---------+-------+---------------+---------+-------+----+----+-----------+</span></span></span></div></pre><ul>
<li>query 1 uses a <strong>type</strong> <code>index</code> without <strong>extra</strong> which means MySQL is planning to perform a full table scan.</li>
<li>query 2 uses a <strong>type</strong> <code>index</code> with an <strong>extra</strong> <code>Using index</code> which means MySQL is planning to scan only the index tree. When using InnoDB storage engine, this can result in less IO work and better performance since InnoDB uses separate files to store indexes.</li>
<li>query 3 uses a <strong>type</strong> <code>range</code> which means that MySQL is going to read rows from specific ranges of the id key.</li>
</ul>
<p>In our situation, the Country table is small enough and will fit in memory. I don&#39;t think even a third world war would reshape the world as we know into millions or even thousands of countries.</p>
<p>We are done with the controller, let&#39;s update the <strong>country</strong> route configuration to support a <strong>page</strong> parameter</p>
<ul>
<li>Edit <strong>src/AppBundle/Resources/config/routing/country.yml</strong> and update the <strong>country</strong> route as following<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>country:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;</span><span class="meta paragraph text"><span>path:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/{page}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;defaults:&nbsp;{&nbsp;_controller:&nbsp;&quot;AppBundle:Country:index&quot;,&nbsp;page:1&nbsp;}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;requirements:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>page:&nbsp;&nbsp;\d+</span></span></span></div></pre><br><br>
Now we need to update the view to be able to navigate to pages.</li>
<li>Edit <strong>src/AppBundle/Resources/views/Country/index.html.twig</strong> and add the navigation table after the last <code>ul</code> (right before the closing block tag)<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&lt;table&gt;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&lt;tr&gt;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&lt;td&gt;Navigation&lt;/td&gt;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{%&nbsp;for&nbsp;page&nbsp;in&nbsp;1..totalPages&nbsp;%}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&lt;td&gt;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&lt;a&nbsp;href=&quot;{{&nbsp;path(&#39;country&#39;,&nbsp;{&nbsp;&#39;page&#39;:&nbsp;page&nbsp;})&nbsp;}}&quot;&gt;{{page}}&lt;/a&gt;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&lt;/td&gt;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>{%&nbsp;endfor&nbsp;%}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&lt;/tr&gt;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&lt;/table&gt;</span></span></span></div></pre></li>
</ul>
<p>We are done, before checking the result of our work, let&#39;s run our tests suite to make sure we didn&#39;t broke anything.</p>
<pre class="editor-colors lang-bash"><div class="line"><span class="source shell"><span>$&nbsp;phpunit&nbsp;-c&nbsp;app</span></span></div><div class="line"><span class="source shell"><span>PHPUnit&nbsp;3.7.28&nbsp;by&nbsp;Sebastian&nbsp;Bergmann.</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>Configuration&nbsp;</span><span class="support function builtin shell"><span>read</span></span><span>&nbsp;from&nbsp;/home/ubuntu/web/symfony-tutorial/app/phpunit.xml.dist</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>FEE</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>Time:&nbsp;3.07&nbsp;seconds,&nbsp;Memory:&nbsp;16.00Mb</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>There&nbsp;were&nbsp;2&nbsp;errors:</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>1)&nbsp;AppBundle</span><span class="constant character escape shell"><span>\T</span></span><span>ests</span><span class="constant character escape shell"><span>\C</span></span><span>ontroller</span><span class="constant character escape shell"><span>\C</span></span><span>ountryControllerTest::testNewAction</span></span></div><div class="line"><span class="source shell"><span>InvalidArgumentException:&nbsp;The&nbsp;current&nbsp;node&nbsp;list&nbsp;is&nbsp;empty.</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>/.../vendor/symfony/symfony/src/Symfony/Component/DomCrawler/Crawler.php:750</span></span></div><div class="line"><span class="source shell"><span>/.../src/AppBundle/Tests/Controller/CountryControllerTest.php:88</span></span></div><div class="line"><span class="source shell"><span>/.../src/AppBundle/Tests/Controller/CountryControllerTest.php:23</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>2)&nbsp;AppBundle</span><span class="constant character escape shell"><span>\T</span></span><span>ests</span><span class="constant character escape shell"><span>\C</span></span><span>ontroller</span><span class="constant character escape shell"><span>\C</span></span><span>ountryControllerTest::testUpdateAction</span></span></div><div class="line"><span class="source shell"><span>InvalidArgumentException:&nbsp;The&nbsp;current&nbsp;node&nbsp;list&nbsp;is&nbsp;empty.</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>/.../vendor/symfony/symfony/src/Symfony/Component/DomCrawler/Crawler.php:750</span></span></div><div class="line"><span class="source shell"><span>/.../src/AppBundle/Tests/Controller/CountryControllerTest.php:88</span></span></div><div class="line"><span class="source shell"><span>/.../src/AppBundle/Tests/Controller/CountryControllerTest.php:35</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>--</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>There&nbsp;was&nbsp;1&nbsp;failure:</span></span></div><div class="line"><span class="source shell"><span>&nbsp;</span></span></div><div class="line"><span class="source shell"><span>1)&nbsp;AppBundle</span><span class="constant character escape shell"><span>\T</span></span><span>ests</span><span class="constant character escape shell"><span>\C</span></span><span>ontroller</span><span class="constant character escape shell"><span>\C</span></span><span>ountryControllerTest::testIndexAction</span></span></div><div class="line"><span class="source shell"><span>Unexpected&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;</span><span class="meta scope for-in-loop shell"><span class="keyword control shell"><span>for</span></span><span>&nbsp;</span><span class="variable other loop shell"><span>GET</span></span><span>&nbsp;/country/</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>Failed&nbsp;asserting&nbsp;that&nbsp;404&nbsp;matches&nbsp;expected&nbsp;200.</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>&nbsp;</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>/.../src/AppBundle/Tests/Controller/CountryControllerTest.php:17</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>&nbsp;</span></span></span></div><div class="line"><span class="source shell"><span class="meta scope for-in-loop shell"><span>FAILURES</span><span class="keyword operator pipe shell"><span>!</span></span></span></span></div></pre>
<p>Well, seems that we broke something! Indeed, we changed the <strong>country</strong> route path from <code>/</code> to <code>/{page}</code> that means the url <strong>/country/</strong> is not a matched route anymore. This is our first experience during this journey to catch a bug early. If we would have static links to <strong><a href="http://symfony.local/country/">http://symfony.local/country/</a></strong> we would need to update them.
For the moment, we just need to update our test and change occurrences of <code>/country/</code> to <code>/country</code>.</p>
<p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></p>
<h2 id="3-6-exercises">3.6 Exercises</h2>
<p><br>
<strong>3.6.1</strong> The pagination feature we added to the Country::indexAction was awesome. We can already imagine that we will need it for most of our entities. We will extend the crud generator to generate the indexAction with pagination already implemented. Exactly like we did with Country::indexAction. So basically we need to reproduce what we did with Country, but in a more generic way. You will need to override the following skeletons:</p>
<ul>
<li>vendor/sensio/generator-bundle/Sensio/Bundle/GeneratorBundle/Resources/skeleton/crud/actions/index.php.twig</li>
<li>vendor/sensio/generator-bundle/Sensio/Bundle/GeneratorBundle/Resources/skeleton/crud/config/routing.yml.twig</li>
<li>vendor/sensio/generator-bundle/Sensio/Bundle/GeneratorBundle/Resources/skeleton/crud/views/index.html.twig.twig
And update app/Resources/SensioGeneratorBundle/skeleton/crud/tests/others/full_scenario.php.twig to fix the failing test (the issue with the path /country/)</li>
</ul>
<p><br><br><br></p>
<p><strong>3.6.2</strong> The generated test suite is very helpful. It needs some annoying manual maintenance though. The method <code>getNewFormFields</code> looks like</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>protected&nbsp;function&nbsp;getNewFormFields()</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>return&nbsp;array(</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&#39;field_name&#39;&nbsp;=&gt;&nbsp;&#39;value&#39;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//other&nbsp;fields</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><p>We want to automate this part so the generated method would look like</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>protected&nbsp;function&nbsp;getNewFormFields()</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>return&nbsp;array(</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&#39;code&#39;&nbsp;=&gt;&nbsp;&#39;txt_c&#39;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;name&#39;&nbsp;=&gt;&nbsp;&#39;txt_name&#39;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;currency&#39;&nbsp;=&gt;&nbsp;&#39;txt&#39;,</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><blockquote>
<p>Note that the values are truncated to match the column length.</p>
</blockquote>
<p>To build such an array, we definitely need the mapping metadata. We can&#39;t solve this issue just by overriding a skeleton. To understand how the mechanism works, take a look at <code>Sensio\Bundle\GeneratorBundle\Command\GenerateDoctrineCrudCommand::createGenerator()</code> is returning an instance of <code>Sensio\Bundle\GeneratorBundle\Generator::DoctrineCrudGenerator</code>. We are interested in a particular method from the later class, <code>generateTestClass</code> doesn&#39;t pass any metadata informations to the rendered template <code>crud/tests/test.php.twig</code>.</p>
<p>Besides overriding <strong>crud/tests/test.php.twig</strong> template, you will need to extend <code>Sensio\Bundle\GeneratorBundle\Command\GenerateDoctrineCrudCommand</code> (maybe with the name <code>app:generate:crud</code>) and alter it&#39;s behavior so it passes metadata to the rendered template.</p>
<p>Make sure the tests pass.</p></body>
</html>
